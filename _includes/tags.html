<style>
.tag-hide{
  display: none;
}
.tag-active {
  font-weight: bolder;
}
ul#tags-list{
  list-style: none;
}
ul#tags-list li {
  margin: 8px 0;
  font-size: 1.0em;
}
ul#tags-list li a {
  text-decoration: none;
}
</style>
<br>
<br>
<ul id="tags-list">
  <li><a id="all-tags" href="javascript:posts_show_all();">All</a></li>
</ul>
<script>
var get_all_tags = function(){
  var li_list = $("#posts-archive-list li");
  var all_tags_list = {};
  for (var i = li_list.length - 1; i >= 0; i--) {
    var li_tags_str = $(li_list[i]).attr("tags");
    var li_tags_arr = li_tags_str.split(" ");
    for (var j = li_tags_arr.length - 1; j >= 0; j--) {
      var tag = li_tags_arr[j];
      if(tag != "") {
        if(!!all_tags_list[tag]) { all_tags_list[tag]++;}
        else {all_tags_list[tag] = 1;}
      }
    }
  }
  return all_tags_list;
};
var sort_dictionary = function(dict){
  var sortable = [];
  for (var key in dict) {
      sortable.push([key, dict[key]]);
  }
  sortable.sort(function(a, b) {
      return a[1] - b[1];
  });
  return sortable;
};
var append_tag_li = function(sorted_array){
  for (var i = sorted_array.length - 1; i >= 0; i--) {
    var tag = sorted_array[i][0];
    var count = sorted_array[i][1];
    $("#tags-list").append("<li><a data-tag='"+tag+"' href='javascript:;'>"+tag+"</a></li>");
    $("#tags-list li a[data-tag='"+tag+"']").on("click", function(){
      toggle_tag($(this).data("tag"));
    })
  }
};
var toggle_tag = function(tag){
  var li_list = $("#posts-archive-list li");
  for (var i = li_list.length - 1; i >= 0; i--) {
    var li = li_list[i];
    var li_tags_str = $(li).attr("tags");
    if(li_tags_str.indexOf(tag) >= 0){
      $(li).removeClass("tag-hide");
    } else {
      $(li).addClass("tag-hide");
    }
  }
  location.hash = tag;
  clear_tags_active();
  $("#tags-list li a[data-tag='"+tag+"']").addClass("tag-active");
};
var posts_show_all = function(){
  var li_list = $("#posts-archive-list li");
  for (var i = li_list.length - 1; i >= 0; i--) {
    $(li_list[i]).removeClass("tag-hide");
  }
  location.hash = "";
  clear_tags_active();
  $("#clear_tags_active").addClass("tag-active");
};
var clear_tags_active = function(){
  var li_list = $("#tags-list li a");
  for (var i = li_list.length - 1; i >= 0; i--) {
    $(li_list[i]).removeClass("tag-active");
  }
};

$(function(){
  var all_tags_dict = get_all_tags();
  var sorted_array = sort_dictionary(all_tags_dict);
  append_tag_li(sorted_array);
  var hash_tag = decodeURI(location.hash.substring(1));
  toggle_tag(hash_tag);
});
</script>